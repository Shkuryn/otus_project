<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="bpmn-js (https://demo.bpmn.io)" exporterVersion="18.6.1">
  <bpmn:collaboration id="Collaboration_1">
    <bpmn:participant id="Participant_App" name="Мобильное приложение" processRef="Process_App" />
    <bpmn:participant id="Participant_Broker" name="Брокер сообщений" processRef="Process_Broker" />
    <bpmn:participant id="Participant_1C" name="База 1С" processRef="Process_1C" />
    <bpmn:messageFlow id="Flow_AppToBroker" name="Заявка" sourceRef="Task_SendRequest" targetRef="Task_BrokerReceiveRequest" />
    <bpmn:messageFlow id="Flow_1CToBroker" name="Статус" sourceRef="Task_SendToBroker" targetRef="Task_BrokerReceiveResult" />
    <bpmn:messageFlow id="Flow_BrokerToApp" name="Результат" sourceRef="Task_BrokerReceiveResult" targetRef="Task_ReceiveStatus" />
    <bpmn:messageFlow id="Flow_1hwxe63" sourceRef="Task_BrokerReceiveRequest" targetRef="Activity_1nspmx8" />
  </bpmn:collaboration>
  <bpmn:process id="Process_App" isExecutable="true">
    <bpmn:laneSet>
      <bpmn:lane id="Lane_App" name="Мобильное приложение" />
    </bpmn:laneSet>
    <bpmn:startEvent id="Start_SendRequest" name="Пользователь подаёт заявку" />
    <bpmn:task id="Task_SendRequest" name="Отправить заявку на вывод кэшбэка" />
    <bpmn:task id="Task_ReceiveStatus" name="Получить результат из брокера" />
    <bpmn:endEvent id="End_ReceiveResult" name="Показать результат пользователю" />
    <bpmn:sequenceFlow id="App_Flow_1" sourceRef="Start_SendRequest" targetRef="Task_SendRequest" />
    <bpmn:sequenceFlow id="App_Flow_2" sourceRef="Task_SendRequest" targetRef="Task_ReceiveStatus" />
    <bpmn:sequenceFlow id="App_Flow_3" sourceRef="Task_ReceiveStatus" targetRef="End_ReceiveResult" />
  </bpmn:process>
  <bpmn:process id="Process_Broker" isExecutable="true">
    <bpmn:laneSet>
      <bpmn:lane id="Lane_Broker" name="Брокер сообщений" />
    </bpmn:laneSet>
    <bpmn:task id="Task_BrokerReceiveRequest" name="Принять заявку от приложения" />
    <bpmn:task id="Task_BrokerReceiveResult" name="Получить статус от 1С" />
  </bpmn:process>
  <bpmn:process id="Process_1C" isExecutable="true">
    <bpmn:laneSet>
      <bpmn:lane id="Lane_1C" name="База 1С" />
    </bpmn:laneSet>
    <bpmn:task id="Task_CreateDoc" name="Создать документ &#34;Списание кэшбэка&#34; (статус Новый)">
      <bpmn:incoming>Flow_18lqtmy</bpmn:incoming>
      <bpmn:outgoing>Flow_1rf82vl</bpmn:outgoing>
    </bpmn:task>
    <bpmn:task id="Task_SendToBroker" name="Отправить статус в брокер и обновить статус документа">
      <bpmn:incoming>Flow_1rf82vl</bpmn:incoming>
    </bpmn:task>
    <bpmn:serviceTask id="Activity_1nspmx8" name="Считать заявку из брокера">
      <bpmn:outgoing>Flow_18lqtmy</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_18lqtmy" sourceRef="Activity_1nspmx8" targetRef="Task_CreateDoc" />
    <bpmn:sequenceFlow id="Flow_1rf82vl" sourceRef="Task_CreateDoc" targetRef="Task_SendToBroker" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1">
      <bpmndi:BPMNShape id="Participant_App_di" bpmnElement="Participant_App" isHorizontal="true">
        <dc:Bounds x="160" y="100" width="1000" height="150" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Start_SendRequest_di" bpmnElement="Start_SendRequest" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="212" y="140" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="194" y="176" width="73" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_SendRequest_di" bpmnElement="Task_SendRequest">
        <dc:Bounds x="295" y="142" width="150" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_ReceiveStatus_di" bpmnElement="Task_ReceiveStatus">
        <dc:Bounds x="790" y="142" width="180" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="End_ReceiveResult_di" bpmnElement="End_ReceiveResult" bioc:stroke="#5b176d" bioc:fill="#e1bee7" color:background-color="#e1bee7" color:border-color="#5b176d">
        <dc:Bounds x="1012" y="152" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="993" y="200" width="73" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_App1_di" bpmnElement="App_Flow_1">
        <di:waypoint x="248" y="158" />
        <di:waypoint x="295" y="158" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_App2_di" bpmnElement="App_Flow_2">
        <di:waypoint x="445" y="170" />
        <di:waypoint x="790" y="170" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_App3_di" bpmnElement="App_Flow_3">
        <di:waypoint x="970" y="170" />
        <di:waypoint x="1012" y="170" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="Participant_Broker_di" bpmnElement="Participant_Broker" isHorizontal="true">
        <dc:Bounds x="160" y="270" width="1000" height="120" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_BrokerReceiveRequest_di" bpmnElement="Task_BrokerReceiveRequest">
        <dc:Bounds x="310" y="290" width="200" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_BrokerReceiveResult_di" bpmnElement="Task_BrokerReceiveResult">
        <dc:Bounds x="790" y="302" width="200" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Participant_1C_di" bpmnElement="Participant_1C" isHorizontal="true">
        <dc:Bounds x="160" y="420" width="1000" height="130" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_CreateDoc_di" bpmnElement="Task_CreateDoc">
        <dc:Bounds x="540" y="440" width="200" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_SendToBroker_di" bpmnElement="Task_SendToBroker">
        <dc:Bounds x="760" y="440" width="240" height="56" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1nspmx8_di" bpmnElement="Activity_1nspmx8">
        <dc:Bounds x="380" y="428" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_1rf82vl_di" bpmnElement="Flow_1rf82vl">
        <di:waypoint x="740" y="468" />
        <di:waypoint x="760" y="468" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_18lqtmy_di" bpmnElement="Flow_18lqtmy">
        <di:waypoint x="480" y="468" />
        <di:waypoint x="540" y="468" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_AppToBroker_di" bpmnElement="Flow_AppToBroker">
        <di:waypoint x="445" y="188" />
        <di:waypoint x="445" y="290" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="461" y="229" width="37" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1CToBroker_di" bpmnElement="Flow_1CToBroker">
        <di:waypoint x="880" y="440" />
        <di:waypoint x="880" y="358" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="877" y="390" width="36" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_BrokerToApp_di" bpmnElement="Flow_BrokerToApp">
        <di:waypoint x="890" y="302" />
        <di:waypoint x="890" y="198" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="880" y="241" width="51" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1hwxe63_di" bpmnElement="Flow_1hwxe63">
        <di:waypoint x="450" y="350" />
        <di:waypoint x="450" y="428" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
